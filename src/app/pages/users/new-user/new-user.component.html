<p-toast></p-toast>
<p-dialog [(visible)]="visible" [modal]="true" (onHide)="handleCancel()" [draggable]="false" header="Crear usuario"
    [style]="{width: '600px'}">

    <ng-container *ngIf="!userType">
        <div class="admin-select-specialty-container">
            <div class="specialty-col" (click)="handleSelectRegisterType('patient')">
                <svg viewBox="0 0 24 24" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="ic_fluent_patient_24_regular" fill="#212121" fill-rule="nonzero">
                                <path
                                    d="M17.75,2 C18.9926407,2 20,3.00735931 20,4.25 L20,19.754591 C20,20.9972317 18.9926407,22.004591 17.75,22.004591 L6.25,22.004591 C5.00735931,22.004591 4,20.9972317 4,19.754591 L4,4.25 C4,3.05913601 4.92516159,2.08435508 6.09595119,2.00519081 L6.25,2 L17.75,2 Z M18.5,16 L5.5,16 L5.5,19.754591 C5.5,20.1688046 5.83578644,20.504591 6.25,20.504591 L17.75,20.504591 C18.1642136,20.504591 18.5,20.1688046 18.5,19.754591 L18.5,16 Z M7.75128856,17.5 L16.25,17.5 C16.6642136,17.5 17,17.8357864 17,18.25 C17,18.6296958 16.7178461,18.943491 16.3517706,18.9931534 L16.25,19 L7.75128856,19 C7.337075,19 7.00128856,18.6642136 7.00128856,18.25 C7.00128856,17.8703042 7.28344245,17.556509 7.64951801,17.5068466 L7.75128856,17.5 L16.25,17.5 L7.75128856,17.5 Z M17.75,3.5 L6.25,3.5 L6.14822944,3.50684662 C5.78215388,3.55650904 5.5,3.87030423 5.5,4.25 L5.5,14.5 L8,14.5 L8,12.2455246 C8,11.5983159 8.49187466,11.0659907 9.12219476,11.0019782 L9.25,10.9955246 L14.75,10.9955246 C15.3972087,10.9955246 15.9295339,11.4873992 15.9935464,12.1177193 L16,12.2455246 L16,14.5 L18.5,14.5 L18.5,4.25 C18.5,3.83578644 18.1642136,3.5 17.75,3.5 Z M14.5,12.4955246 L9.5,12.4955246 L9.5,14.5 L14.5,14.5 L14.5,12.4955246 Z M12,4.99552458 C13.3807119,4.99552458 14.5,6.11481271 14.5,7.49552458 C14.5,8.87623646 13.3807119,9.99552458 12,9.99552458 C10.6192881,9.99552458 9.5,8.87623646 9.5,7.49552458 C9.5,6.11481271 10.6192881,4.99552458 12,4.99552458 Z M12,6.49552458 C11.4477153,6.49552458 11,6.94323983 11,7.49552458 C11,8.04780933 11.4477153,8.49552458 12,8.49552458 C12.5522847,8.49552458 13,8.04780933 13,7.49552458 C13,6.94323983 12.5522847,6.49552458 12,6.49552458 Z">
                                </path>

                            </g>
                        </g>
                    </g>
                </svg>
                <h3>Paciente</h3>
            </div>

            <div class="specialty-col" (click)="handleSelectRegisterType('specialist')">
                <svg id="Icons" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" xml:space="preserve"
                    fill="#000000">
                    <g stroke-width="0"></g>
                    <g stroke-linecap="round" stroke-linejoin="round"></g>
                    <g>
                        <g>
                            <path d="M16,9c1.7,0,3-1.3,3-3s-1.3-3-3-3s-3,1.3-3,3S14.3,9,16,9z"></path>
                            <path
                                d="M29.7,11.3l-7-6.5c-0.3-0.3-0.7-0.3-1.1-0.2c-0.4,0.2-0.6,0.6-0.6,1c0,0.1,0,0.3,0,0.4c0,2.8-2.2,5-5,5s-5-2.2-5-5 c0-0.1,0-0.3,0-0.4c0-0.4-0.2-0.8-0.6-1c-0.4-0.2-0.8-0.1-1.1,0.2l-7,6.5c-0.3,0.2-0.4,0.6-0.3,1s0.3,0.6,0.7,0.7l8.9,2.8 C10.1,16.3,9,17.2,9,18.5c0,0.5,0.2,1.3,1.1,2c0.4,0.3,1.1,0.2,1.4-0.2c0.3-0.4,0.2-1.1-0.2-1.4c-0.3-0.2-0.3-0.4-0.3-0.4 c0-0.3,1.4-1.3,4-1.5v3c-2.3,0.3-4,1.4-4,2.9c0,1,0.7,1.8,1.8,2.4c0.1,0.1,0.3,0.1,0.4,0.1c0.4,0,0.7-0.2,0.9-0.6 c0.2-0.5,0-1.1-0.5-1.3C13.2,23.3,13,23.1,13,23c0-0.2,0.7-0.7,2-0.9V27c0,0.6,0.4,1,1,1s1-0.4,1-1v-0.8c0.6,0.2,1,0.6,1,0.8 c0,0.4-0.8,1-2,1s-2-0.6-2-1c0-0.6-0.4-1-1-1s-1,0.4-1,1c0,1.7,1.8,3,4,3s4-1.3,4-3c0-1.4-1.3-2.6-3-2.9V22c3.1-0.2,6-1.4,6-3.5 c0-1.3-1.1-2.2-2.6-2.8l8.9-2.8c0.3-0.1,0.6-0.4,0.7-0.7S29.9,11.5,29.7,11.3z M21,18.5c0,0.3-1.4,1.3-4,1.5V17 C19.6,17.2,21,18.2,21,18.5z">
                            </path>
                        </g>
                    </g>
                </svg>
                <h3>Especialista</h3>
            </div>

            <div class="specialty-col" (click)="handleSelectRegisterType('admin')">

                <svg fill="#000000" height="200px" width="200px" version="1.1" id="Capa_1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                    viewBox="0 0 474.565 474.565" xml:space="preserve">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g>
                            <path
                                d="M255.204,102.3c-0.606-11.321-12.176-9.395-23.465-9.395C240.078,95.126,247.967,98.216,255.204,102.3z">
                            </path>
                            <path
                                d="M134.524,73.928c-43.825,0-63.997,55.471-28.963,83.37c11.943-31.89,35.718-54.788,66.886-63.826 C163.921,81.685,150.146,73.928,134.524,73.928z">
                            </path>
                            <path
                                d="M43.987,148.617c1.786,5.731,4.1,11.229,6.849,16.438L36.44,179.459c-3.866,3.866-3.866,10.141,0,14.015l25.375,25.383 c1.848,1.848,4.38,2.888,7.019,2.888c2.61,0,5.125-1.04,7.005-2.888l14.38-14.404c2.158,1.142,4.55,1.842,6.785,2.827 c0-0.164-0.016-0.334-0.016-0.498c0-11.771,1.352-22.875,3.759-33.302c-17.362-11.174-28.947-30.57-28.947-52.715 c0-34.592,28.139-62.739,62.723-62.739c23.418,0,43.637,13.037,54.43,32.084c11.523-1.429,22.347-1.429,35.376,1.033 c-1.676-5.07-3.648-10.032-6.118-14.683l14.396-14.411c1.878-1.856,2.918-4.38,2.918-7.004c0-2.625-1.04-5.148-2.918-7.004 l-25.361-25.367c-1.94-1.941-4.472-2.904-7.003-2.904c-2.532,0-5.063,0.963-6.989,2.904l-14.442,14.411 c-5.217-2.764-10.699-5.078-16.444-6.825V9.9c0-5.466-4.411-9.9-9.893-9.9h-35.888c-5.451,0-9.909,4.434-9.909,9.9v20.359 c-5.73,1.747-11.213,4.061-16.446,6.825L75.839,22.689c-1.942-1.941-4.473-2.904-7.005-2.904c-2.531,0-5.077,0.963-7.003,2.896 L36.44,48.048c-1.848,1.864-2.888,4.379-2.888,7.012c0,2.632,1.04,5.148,2.888,7.004l14.396,14.403 c-2.75,5.218-5.063,10.708-6.817,16.438H23.675c-5.482,0-9.909,4.441-9.909,9.915v35.889c0,5.458,4.427,9.908,9.909,9.908H43.987z">
                            </path>
                            <path
                                d="M354.871,340.654c15.872-8.705,26.773-25.367,26.773-44.703c0-28.217-22.967-51.168-51.184-51.168 c-9.923,0-19.118,2.966-26.975,7.873c-4.705,18.728-12.113,36.642-21.803,52.202C309.152,310.022,334.357,322.531,354.871,340.654z ">
                            </path>
                            <path
                                d="M460.782,276.588c0-5.909-4.799-10.693-10.685-10.693H428.14c-1.896-6.189-4.411-12.121-7.393-17.75l15.544-15.544 c2.02-2.004,3.137-4.721,3.137-7.555c0-2.835-1.118-5.553-3.137-7.563l-27.363-27.371c-2.08-2.09-4.829-3.138-7.561-3.138 c-2.734,0-5.467,1.048-7.547,3.138l-15.576,15.552c-5.623-2.982-11.539-5.481-17.751-7.369v-21.958 c0-5.901-4.768-10.685-10.669-10.685H311.11c-2.594,0-4.877,1.04-6.739,2.578c3.26,11.895,5.046,24.793,5.046,38.552 c0,8.735-0.682,17.604-1.956,26.423c7.205-2.656,14.876-4.324,22.999-4.324c36.99,0,67.086,30.089,67.086,67.07 c0,23.637-12.345,44.353-30.872,56.303c13.48,14.784,24.195,32.324,31.168,51.976c1.148,0.396,2.344,0.684,3.54,0.684 c2.733,0,5.467-1.04,7.563-3.13l27.379-27.371c2.004-2.004,3.106-4.721,3.106-7.555s-1.102-5.551-3.106-7.563l-15.576-15.552 c2.982-5.621,5.497-11.555,7.393-17.75h21.957c2.826,0,5.575-1.118,7.563-3.138c2.004-1.996,3.138-4.72,3.138-7.555 L460.782,276.588z">
                            </path>
                            <path
                                d="M376.038,413.906c-16.602-48.848-60.471-82.445-111.113-87.018c-16.958,17.958-37.954,29.351-61.731,29.351 c-23.759,0-44.771-11.392-61.713-29.351c-50.672,4.573-94.543,38.17-111.145,87.026l-9.177,27.013 c-2.625,7.773-1.368,16.338,3.416,23.007c4.783,6.671,12.486,10.631,20.685,10.631h315.853c8.215,0,15.918-3.96,20.702-10.631 c4.767-6.669,6.041-15.234,3.4-23.007L376.038,413.906z">
                            </path>
                            <path
                                d="M120.842,206.782c0,60.589,36.883,125.603,82.352,125.603c45.487,0,82.368-65.014,82.368-125.603 C285.563,81.188,120.842,80.939,120.842,206.782z">
                            </path>
                        </g>
                    </g>
                </svg>

                <h3>Administrador</h3>
            </div>

        </div>
    </ng-container>

    <div *ngIf="userType" class="grid">
        <form [formGroup]="registerForm" (submit)="submit()" class="col">

            <div class="col-12">
                <div class="input-container">
                    <label for="firstName">Nombre</label>
                    <input type="text" placeholder="Ingrese su nombre" formControlName="firstName" pInputText>
                    <div *ngIf="formControls['firstName'].touched && formControls['firstName'].invalid" class="error">
                        El nombre es requerido y solo debe contener letras
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="input-container">
                    <label for="lastName">Apellido</label>
                    <input type="text" placeholder="Ingrese su apellido" formControlName="lastName" pInputText>
                    <div *ngIf="formControls['lastName'].touched && formControls['lastName'].invalid" class="error">
                        El apellido es requerido y solo debe contener letras
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="input-container">
                    <label for="age">Edad</label>
                    <input type="number" placeholder="Ingrese su edad" formControlName="age" pInputText>
                    <div *ngIf="formControls['age'].touched && formControls['age'].invalid" class="error">
                        <ng-container *ngIf="userType === 'specialist'">
                            La edad debe estar entre 18 y 100 años
                        </ng-container>
                        <ng-container *ngIf="userType === 'patient'">
                            La edad debe estar entre 0 y 100 años
                        </ng-container>
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="input-container">
                    <label for="dni">DNI</label>
                    <input type="number" placeholder="Ingrese su DNI" formControlName="dni" pInputText>
                    <div *ngIf="formControls['dni'].touched && formControls['dni'].invalid" class="error">
                        El DNI es requerido y debe tener entre 7 y 8 caracteres
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="input-container">
                    <label for="email">Email</label>
                    <input type="text" placeholder="Ingrese su correo electrónico" formControlName="email" pInputText>
                    <div *ngIf="formControls['email'].touched && formControls['email'].invalid" class="error">
                        El email es requerido y debe tener el formato correcto
                    </div>
                </div>
            </div>

            <div *ngIf="userType === 'patient'" class="col-12">
                <div class="input-container">
                    <label for="healthcare">Obra social</label>
                    <input type="text" placeholder="Ingrese su obra social" formControlName="healthcare" pInputText>
                    <div *ngIf="formControls['healthcare'].touched && formControls['healthcare'].invalid" class="error">
                        La obra social es requerida
                    </div>
                </div>
            </div>

            <div *ngIf="userType === 'specialist'" class="col-12">
                <div class="input-container">
                    <label for="specialty">Especialidad</label>
                    <!-- <p-dropdown class="p-fluid" [options]="allSpecialties" (onChange)="handleChangeSpecialty($event)"
                        formControlName="specialty" placeholder="Ingrese la especialidad" optionLabel="displayName"
                        optionValue="displayName" />
                    <div *ngIf="formControls['specialty'].touched && formControls['specialty'].invalid" class="error">
                        La especialidad es requerida
                    </div> -->
                    <p-multiSelect class="p-fluid" (onChange)="handleChangeSpecialty($event)" [showToggleAll]="false"
                        [options]="allSpecialties" formControlName="specialty" optionLabel="displayName"
                        optionValue="displayName" placeholder="Selecciona una especialidad" />
                    <div *ngIf="formControls['specialty'].touched && formControls['specialty'].invalid" class="error">
                        La especialidad es requerida
                    </div>
                </div>
            </div>

            <div class="col-12" style="display: flex; align-items: flex-end;">
                <div class="input-container" style="width: 100%;">
                    <div class="chip-row">
                        <div class="file-chip" [pTooltip]="item.name"
                            *ngFor="let item of formControls['attachedImage'].value">
                            <span>{{item.name}}</span> <i (click)="handleRemoveImage(item)" class="pi pi-times"></i>
                        </div>
                    </div>
                    <label for="fileInput" class="file-label" pButton>Agregar imagen</label>
                    <input id="fileInput" (change)="handleAddFile($event)" type="file" hidden pInputText>
                    <div *ngIf="formControls['attachedImage'].touched && formControls['attachedImage'].invalid"
                        class="error">
                        Debe cargar {{userType === 'patient' ? '2 imagenes' : '1 imagen'}}
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="input-container">
                    <label for="password">Contraseña</label>
                    <input type="password" placeholder="Ingrese su contraseña" formControlName="password" pInputText>
                    <div *ngIf="formControls['password'].touched && formControls['password'].invalid" class="error">
                        La contraseña debe tener por lo menos 8 caracteres
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="input-container">
                    <label for="confirmPassword">Confirmar contraseña</label>
                    <input type="password" placeholder="Confirme su contraseña" formControlName="confirmPassword"
                        pInputText>
                    <div class="error"
                        *ngIf="registerForm.hasError('passwordMatch') && (registerForm.get('confirmPassword').dirty || registerForm.get('confirmPassword').touched)">
                        Las contraseñas no coinciden.
                    </div>
                </div>
            </div>

            <div class="col"
                style="display: flex; align-items: center; justify-content: flex-end; height: 40px; margin-top: 20px; gap: 8px;">
                <button class="outlined" pButton (click)="handleCancel()">Cancelar</button>
                <button type="submit" [disabled]="registerLoading" pButton>
                    Enviar
                    <i *ngIf="registerLoading" class="pi pi-spin pi-spinner"></i>
                </button>
            </div>


        </form>


    </div>

    <!-- <div style="display: flex; justify-content: flex-end; gap: 10px; height: 40px;">
        <button class="filled" pButton>Crear</button>
    </div> -->
</p-dialog>

<p-dialog class="modal" header="Crear especialidad" [closable]="false" [draggable]="false"
    [visible]="addSpecialtyVisible" [modal]="true">

    <div style="display: flex; flex-direction: column;gap: 5px;">
        <label for="">Nombre</label>
        <input style="margin-bottom: 12px;" class="p-fluid" type="text" pInputText [(ngModel)]="newSpecialtyName">
    </div>

    <div class="input-container" style="width: 100%;">

        <label for="imageInput" class="file-label" pButton>Agregar imagen</label>
        <input id="imageInput" (change)="handleAddSpecialtyImage($event)" type="file" hidden pInputText>
        <div class="chip-row">
            <div *ngIf="newSpecialtyImage" class="file-chip" [pTooltip]="newSpecialtyImage.name">
                <span>{{newSpecialtyImage.name}}</span> <i (click)="newSpecialtyImage = null" class="pi pi-times"></i>
            </div>
        </div>
    </div>

    <div class="actions">
        <button (click)="handleCancelCreation()" class="outlined" pButton>Cancelar</button>
        <button (click)="handleConfirmCreation()" [disabled]="loadingSpecialty" pButton>Confirmar
            <i *ngIf="loadingSpecialty" class="pi pi-spin pi-spinner"></i></button>
    </div>
</p-dialog>
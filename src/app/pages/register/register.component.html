<p-toast></p-toast>
<div class="screen welcome">
    <div style="display: flex; align-items: center; width: 100%; gap: 8px;">
        <arrow-back />
        <h2 class="title-health">Creemos tu cuenta</h2>
    </div>

    <ng-container *ngIf="!userType">
        <h1>¿Cómo querés registrarte?</h1>
        <div class="select-specialty-container">
            <div class="specialty-col" (click)="handleSelectRegisterType('patient')">
                <svg viewBox="0 0 24 24" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="ic_fluent_patient_24_regular" fill="#212121" fill-rule="nonzero">
                                <path
                                    d="M17.75,2 C18.9926407,2 20,3.00735931 20,4.25 L20,19.754591 C20,20.9972317 18.9926407,22.004591 17.75,22.004591 L6.25,22.004591 C5.00735931,22.004591 4,20.9972317 4,19.754591 L4,4.25 C4,3.05913601 4.92516159,2.08435508 6.09595119,2.00519081 L6.25,2 L17.75,2 Z M18.5,16 L5.5,16 L5.5,19.754591 C5.5,20.1688046 5.83578644,20.504591 6.25,20.504591 L17.75,20.504591 C18.1642136,20.504591 18.5,20.1688046 18.5,19.754591 L18.5,16 Z M7.75128856,17.5 L16.25,17.5 C16.6642136,17.5 17,17.8357864 17,18.25 C17,18.6296958 16.7178461,18.943491 16.3517706,18.9931534 L16.25,19 L7.75128856,19 C7.337075,19 7.00128856,18.6642136 7.00128856,18.25 C7.00128856,17.8703042 7.28344245,17.556509 7.64951801,17.5068466 L7.75128856,17.5 L16.25,17.5 L7.75128856,17.5 Z M17.75,3.5 L6.25,3.5 L6.14822944,3.50684662 C5.78215388,3.55650904 5.5,3.87030423 5.5,4.25 L5.5,14.5 L8,14.5 L8,12.2455246 C8,11.5983159 8.49187466,11.0659907 9.12219476,11.0019782 L9.25,10.9955246 L14.75,10.9955246 C15.3972087,10.9955246 15.9295339,11.4873992 15.9935464,12.1177193 L16,12.2455246 L16,14.5 L18.5,14.5 L18.5,4.25 C18.5,3.83578644 18.1642136,3.5 17.75,3.5 Z M14.5,12.4955246 L9.5,12.4955246 L9.5,14.5 L14.5,14.5 L14.5,12.4955246 Z M12,4.99552458 C13.3807119,4.99552458 14.5,6.11481271 14.5,7.49552458 C14.5,8.87623646 13.3807119,9.99552458 12,9.99552458 C10.6192881,9.99552458 9.5,8.87623646 9.5,7.49552458 C9.5,6.11481271 10.6192881,4.99552458 12,4.99552458 Z M12,6.49552458 C11.4477153,6.49552458 11,6.94323983 11,7.49552458 C11,8.04780933 11.4477153,8.49552458 12,8.49552458 C12.5522847,8.49552458 13,8.04780933 13,7.49552458 C13,6.94323983 12.5522847,6.49552458 12,6.49552458 Z">
                                </path>

                            </g>
                        </g>
                    </g>
                </svg>
                <h2>Como paciente</h2>
            </div>

            <div class="specialty-col" (click)="handleSelectRegisterType('specialist')">
                <svg id="Icons" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" xml:space="preserve"
                    fill="#000000">
                    <g stroke-width="0"></g>
                    <g stroke-linecap="round" stroke-linejoin="round"></g>
                    <g>
                        <g>
                            <path d="M16,9c1.7,0,3-1.3,3-3s-1.3-3-3-3s-3,1.3-3,3S14.3,9,16,9z"></path>
                            <path
                                d="M29.7,11.3l-7-6.5c-0.3-0.3-0.7-0.3-1.1-0.2c-0.4,0.2-0.6,0.6-0.6,1c0,0.1,0,0.3,0,0.4c0,2.8-2.2,5-5,5s-5-2.2-5-5 c0-0.1,0-0.3,0-0.4c0-0.4-0.2-0.8-0.6-1c-0.4-0.2-0.8-0.1-1.1,0.2l-7,6.5c-0.3,0.2-0.4,0.6-0.3,1s0.3,0.6,0.7,0.7l8.9,2.8 C10.1,16.3,9,17.2,9,18.5c0,0.5,0.2,1.3,1.1,2c0.4,0.3,1.1,0.2,1.4-0.2c0.3-0.4,0.2-1.1-0.2-1.4c-0.3-0.2-0.3-0.4-0.3-0.4 c0-0.3,1.4-1.3,4-1.5v3c-2.3,0.3-4,1.4-4,2.9c0,1,0.7,1.8,1.8,2.4c0.1,0.1,0.3,0.1,0.4,0.1c0.4,0,0.7-0.2,0.9-0.6 c0.2-0.5,0-1.1-0.5-1.3C13.2,23.3,13,23.1,13,23c0-0.2,0.7-0.7,2-0.9V27c0,0.6,0.4,1,1,1s1-0.4,1-1v-0.8c0.6,0.2,1,0.6,1,0.8 c0,0.4-0.8,1-2,1s-2-0.6-2-1c0-0.6-0.4-1-1-1s-1,0.4-1,1c0,1.7,1.8,3,4,3s4-1.3,4-3c0-1.4-1.3-2.6-3-2.9V22c3.1-0.2,6-1.4,6-3.5 c0-1.3-1.1-2.2-2.6-2.8l8.9-2.8c0.3-0.1,0.6-0.4,0.7-0.7S29.9,11.5,29.7,11.3z M21,18.5c0,0.3-1.4,1.3-4,1.5V17 C19.6,17.2,21,18.2,21,18.5z">
                            </path>
                        </g>
                    </g>
                </svg>
                <h2>Como especialista</h2>
            </div>

        </div>
    </ng-container>

    <div *ngIf="userType" class="grid">

        <form [formGroup]="registerForm" (submit)="submit()" class="col-12 md:col-6 grid">

            <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="firstName">Nombre</label>
                    <input type="text" placeholder="Ingrese su nombre" formControlName="firstName" pInputText>
                    <div *ngIf="formControls['firstName'].touched && formControls['firstName'].invalid" class="error">
                        El nombre es requerido y solo debe contener letras
                    </div>
                </div>
            </div>
            <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="lastName">Apellido</label>
                    <input type="text" placeholder="Ingrese su apellido" formControlName="lastName" pInputText>
                    <div *ngIf="formControls['lastName'].touched && formControls['lastName'].invalid" class="error">
                        El apellido es requerido y solo debe contener letras
                    </div>
                </div>
            </div>

            <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="age">Edad</label>
                    <input type="number" placeholder="Ingrese su edad" formControlName="age" pInputText>
                    <div *ngIf="formControls['age'].touched && formControls['age'].invalid" class="error">
                        <ng-container *ngIf="userType === 'specialist'">
                            La edad debe estar entre 18 y 100 años
                        </ng-container>
                        <ng-container *ngIf="userType === 'patient'">
                            La edad debe estar entre 0 y 100 años
                        </ng-container>
                    </div>
                </div>
            </div>

            <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="dni">DNI</label>
                    <input type="number" placeholder="Ingrese su DNI" formControlName="dni" pInputText>
                    <div *ngIf="formControls['dni'].touched && formControls['dni'].invalid" class="error">
                        El DNI es requerido y debe tener entre 7 y 8 caracteres
                    </div>
                </div>
            </div>

            <!-- <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="type">Tipo de usuario</label>
                    <p-dropdown class="p-fluid" formControlName="type" [options]="roleOptions" optionLabel="label"
                        placeholder="Tipo de usuario" (onChange)="handleSelectUserType($event)" />
                    <div *ngIf="formControls['type'].touched && formControls['type'].invalid" class="error">
                        El tipo de usuario es requerido
                    </div>
                </div>
            </div> -->

            <div class="col-12">
                <div class="input-container">
                    <label for="email">Email</label>
                    <input type="text" placeholder="Ingrese su correo electrónico" formControlName="email" pInputText>
                    <div *ngIf="formControls['email'].touched && formControls['email'].invalid" class="error">
                        El email es requerido y debe tener el formato correcto
                    </div>
                </div>
            </div>

            <div *ngIf="userType === 'patient'" class="col-12 md:col-6">
                <div class="input-container">
                    <label for="healthcare">Obra social</label>
                    <input type="text" placeholder="Ingrese su obra social" formControlName="healthcare" pInputText>
                    <div *ngIf="formControls['healthcare'].touched && formControls['healthcare'].invalid" class="error">
                        La obra social es requerida
                    </div>
                </div>
            </div>

            <div *ngIf="userType === 'specialist'" class="col-12 md:col-6">
                <div class="input-container">
                    <label for="specialty">Especialidad</label>
                    <p-dropdown class="p-fluid" [options]="allSpecialties" (onChange)="handleChangeSpecialty($event)"
                        formControlName="specialty" placeholder="Ingrese la especialidad" optionLabel="displayName"
                        optionValue="displayName" />
                    <div *ngIf="formControls['specialty'].touched && formControls['specialty'].invalid" class="error">
                        La especialidad es requerida
                    </div>
                </div>
            </div>

            <div class="col-12 md:col-6" style="display: flex; align-items: flex-end;">
                <div class="input-container" style="width: 100%;">
                    <div class="chip-row">
                        <div class="file-chip" [pTooltip]="item.name"
                            *ngFor="let item of formControls['attachedImage'].value">
                            <span>{{item.name}}</span> <i (click)="handleRemoveImage(item)" class="pi pi-times"></i>
                        </div>
                    </div>
                    <label for="fileInput" class="file-label" pButton>Agregar imagen</label>
                    <input id="fileInput" (change)="handleAddFile($event)" type="file" hidden pInputText>
                    <div *ngIf="formControls['attachedImage'].touched && formControls['attachedImage'].invalid"
                        class="error">
                        Debe cargar {{userType === 'patient' ? '2 imagenes' : '1 imagen'}}
                    </div>
                </div>
            </div>

            <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="password">Contraseña</label>
                    <input type="password" placeholder="Ingrese su contraseña" formControlName="password" pInputText>
                    <div *ngIf="formControls['password'].touched && formControls['password'].invalid" class="error">
                        La contraseña debe tener por lo menos 8 caracteres
                    </div>
                </div>
            </div>

            <div class="col-12 md:col-6">
                <div class="input-container">
                    <label for="confirmPassword">Confirmar contraseña</label>
                    <input type="password" placeholder="Confirme su contraseña" formControlName="confirmPassword"
                        pInputText>
                    <div class="error"
                        *ngIf="registerForm.hasError('passwordMatch') && (registerForm.get('confirmPassword').dirty || registerForm.get('confirmPassword').touched)">
                        Las contraseñas no coinciden.
                    </div>
                </div>
            </div>

            <div class="col" style="display: flex; align-items: center;">
                <button type="submit" [disabled]="registerLoading" pButton>
                    Enviar
                    <i *ngIf="registerLoading" class="pi pi-spin pi-spinner"></i>
                </button>
            </div>

        </form>

        <div class="col-12 md:col-6 grid">
            <img class="welcome-image"
                src="https://st4.depositphotos.com/26044198/29025/v/450/depositphotos_290256352-stock-illustration-vector-modern-flat-online-medicine.jpg"
                alt="">
        </div>


    </div>
</div>

<p-dialog class="modal" header="Crear especialidad" [closable]="false" [draggable]="false" [visible]="visible"
    [modal]="true">

    <input class="p-fluid" type="text" pInputText [(ngModel)]="newSpecialtyName">

    <div class="actions">
        <button (click)="handleCancelCreation()" class="outlined" pButton>Cancelar</button>
        <button (click)="handleConfirmCreation()" [disabled]="loadingSpecialty" pButton>Confirmar
            <i *ngIf="loadingSpecialty" class="pi pi-spin pi-spinner"></i></button>
    </div>
</p-dialog>